# Black Feather å¯©æ ¸ç³»çµ±å®Œæ•´æŒ‡å—

## ç³»çµ±æ¦‚è¿°

Black Feather å«è»Šå¹³å°ç¾å·²å»ºç«‹å®Œæ•´çš„é›™å‘å¯©æ ¸æ©Ÿåˆ¶ï¼Œç¢ºä¿æ‰€æœ‰å¸æ©Ÿå’Œä¹˜å®¢åœ¨ä½¿ç”¨æœå‹™å‰éƒ½ç¶“éç®¡ç†å“¡å¯©æ ¸ã€‚

## å¯©æ ¸æµç¨‹æ¶æ§‹

### 1. å¸æ©Ÿè¨»å†Šèˆ‡å¯©æ ¸æµç¨‹

#### è¨»å†Šæµç¨‹
1. å¸æ©Ÿé€šé `/auth/register` é é¢æäº¤è¨»å†Šç”³è«‹
2. å¡«å¯«è³‡æ–™åŒ…æ‹¬ï¼š
   - åŸºæœ¬è³‡æ–™ï¼ˆå§“åã€æ‰‹æ©Ÿã€èº«åˆ†è­‰ï¼‰
   - å¯†ç¢¼è¨­å®š
   - é§•ç…§è³‡æ–™ï¼ˆè™Ÿç¢¼ã€åˆ°æœŸæ—¥ï¼‰
   - è»Šè¼›è³‡æ–™ï¼ˆå“ç‰Œã€è»Šç‰Œã€é¡è‰²ï¼‰
   - ç·Šæ€¥è¯çµ¡äºº
   - è¡—å£å¸³è™Ÿï¼ˆé¸å¡«ï¼‰

#### è³‡æ–™åº«è¨˜éŒ„
è¨»å†Šæ™‚ç³»çµ±æœƒè‡ªå‹•å‰µå»ºï¼š
- `users` è¡¨è¨˜éŒ„ï¼ˆstatus: pending, verification_status: pendingï¼‰
- `driver_applications` è¡¨è¨˜éŒ„ï¼ˆstatus: pendingï¼‰
- `drivers` è¡¨è¨˜éŒ„ï¼ˆverification_status: pendingï¼‰
- `vehicles` è¡¨è¨˜éŒ„ï¼ˆå¦‚æœ‰è»Šè¼›è³‡æ–™ï¼‰

#### å¯©æ ¸æµç¨‹
1. ç®¡ç†å“¡ç™»å…¥å¾Œå°ï¼ˆ`/admin`ï¼‰
2. é»æ“Šã€Œå¸æ©Ÿç”³è«‹å¯©æ ¸ã€é€²å…¥ `/admin/driver-applications`
3. æŸ¥çœ‹å¾…å¯©æ ¸ç”³è«‹åˆ—è¡¨
4. é»æ“Šã€ŒæŸ¥çœ‹è©³æƒ…ã€æª¢è¦–å®Œæ•´è³‡æ–™
5. é¸æ“‡ã€Œé€šéã€æˆ–ã€Œæ‹’çµ•ã€ï¼š
   - **é€šé**ï¼š
     - æ›´æ–° `driver_applications.status` â†’ 'approved'
     - æ›´æ–° `users.status` â†’ 'active'
     - æ›´æ–° `users.verification_status` â†’ 'approved'
     - æ›´æ–° `drivers.verification_status` â†’ 'approved'
     - ç™¼é€é€šçŸ¥çµ¦ç”³è«‹è€…
   - **æ‹’çµ•**ï¼š
     - æ›´æ–° `driver_applications.status` â†’ 'rejected'
     - æ›´æ–° `users.status` â†’ 'rejected'
     - è¨˜éŒ„æ‹’çµ•åŸå› 
     - ç™¼é€æ‹’çµ•é€šçŸ¥

### 2. ä¹˜å®¢è¨»å†Šèˆ‡å¯©æ ¸æµç¨‹

#### è¨»å†Šæµç¨‹
1. ä¹˜å®¢é€šé `/passenger/auth/register` é é¢æäº¤è¨»å†Šç”³è«‹
2. å¡«å¯«è³‡æ–™åŒ…æ‹¬ï¼š
   - çœŸå¯¦å§“å
   - æ‰‹æ©Ÿè™Ÿç¢¼
   - é›»å­éƒµä»¶ï¼ˆé¸å¡«ï¼‰
   - å¯†ç¢¼è¨­å®š

#### è³‡æ–™åº«è¨˜éŒ„
è¨»å†Šæ™‚ç³»çµ±æœƒè‡ªå‹•å‰µå»ºï¼š
- `users` è¡¨è¨˜éŒ„ï¼ˆstatus: pending, verification_status: pendingï¼‰
- `user_applications` è¡¨è¨˜éŒ„ï¼ˆstatus: pendingï¼‰

#### å¯©æ ¸æµç¨‹
1. ç®¡ç†å“¡ç™»å…¥å¾Œå°ï¼ˆ`/admin`ï¼‰
2. é»æ“Šã€Œä¹˜å®¢ç”³è«‹å¯©æ ¸ã€é€²å…¥ `/admin/passenger-applications`
3. æŸ¥çœ‹å¾…å¯©æ ¸ç”³è«‹åˆ—è¡¨
4. é»æ“Šã€ŒæŸ¥çœ‹è©³æƒ…ã€æª¢è¦–å®Œæ•´è³‡æ–™
5. é¸æ“‡ã€Œé€šéã€æˆ–ã€Œæ‹’çµ•ã€ï¼š
   - **é€šé**ï¼š
     - æ›´æ–° `user_applications.status` â†’ 'approved'
     - æ›´æ–° `users.status` â†’ 'active'
     - æ›´æ–° `users.verification_status` â†’ 'approved'
     - ç™¼é€é€šçŸ¥çµ¦ç”³è«‹è€…
   - **æ‹’çµ•**ï¼š
     - æ›´æ–° `user_applications.status` â†’ 'rejected'
     - æ›´æ–° `users.status` â†’ 'rejected'
     - è¨˜éŒ„æ‹’çµ•åŸå› 
     - ç™¼é€æ‹’çµ•é€šçŸ¥

## è³‡æ–™åº«æ¶æ§‹

### æ ¸å¿ƒè¡¨çµæ§‹

#### users è¡¨
```sql
- id (uuid, PK)
- phone_number (text)
- full_name (text)
- email (text)
- role (text) -- 'driver' | 'passenger' | 'admin'
- status (text) -- 'pending' | 'active' | 'rejected'
- verification_status (text) -- 'pending' | 'approved' | 'rejected'
- phone_verified (boolean)
- created_at (timestamptz)
```

#### driver_applications è¡¨
```sql
- id (uuid, PK)
- user_id (uuid, FK â†’ users)
- full_name (text)
- phone_number (text)
- id_number (text)
- license_number (text)
- vehicle_plate (text)
- status (text) -- 'pending' | 'approved' | 'rejected'
- priority (text) -- 'low' | 'normal' | 'high' | 'urgent'
- submitted_at (timestamptz)
- reviewed_at (timestamptz)
- reviewed_by (uuid)
- rejection_reason (text)
```

#### user_applications è¡¨
```sql
- id (uuid, PK)
- user_id (uuid, FK â†’ users)
- name (text)
- phone (text)
- email (text)
- status (text) -- 'pending' | 'approved' | 'rejected'
- reviewed_by (text)
- reviewed_at (timestamptz)
- notes (text)
- created_at (timestamptz)
```

#### drivers è¡¨
```sql
- id (uuid, PK)
- user_id (uuid, FK â†’ users)
- application_id (uuid, FK â†’ driver_applications)
- name (text)
- phone (text)
- license_number (text)
- vehicle_plate (text)
- verification_status (text) -- 'pending' | 'approved' | 'rejected'
- work_status (text) -- 'offline' | 'online' | 'busy'
- approved_at (timestamptz)
- approved_by (uuid)
```

## æœå‹™å±¤æ¶æ§‹

### Driver Application Service
æª”æ¡ˆï¼š`services/driver-application.ts`

ä¸»è¦å‡½æ•¸ï¼š
- `submitDriverApplication()` - æäº¤å¸æ©Ÿç”³è«‹
- `getPendingApplications()` - ç²å–æ‰€æœ‰ç”³è«‹ï¼ˆç®¡ç†å“¡ç”¨ï¼‰
- `approveApplication()` - å¯©æ ¸é€šé
- `rejectApplication()` - æ‹’çµ•ç”³è«‹
- `getApplicationDetails()` - ç²å–ç”³è«‹è©³æƒ…

### Passenger Application Service
æª”æ¡ˆï¼š`services/passenger-application.ts`

ä¸»è¦å‡½æ•¸ï¼š
- `submitPassengerApplication()` - æäº¤ä¹˜å®¢ç”³è«‹
- `getAllApplications()` - ç²å–æ‰€æœ‰ç”³è«‹ï¼ˆç®¡ç†å“¡ç”¨ï¼‰
- `approveApplication()` - å¯©æ ¸é€šé
- `rejectApplication()` - æ‹’çµ•ç”³è«‹

## å¾Œå°ç®¡ç†é é¢

### ä¸»æ§å°
è·¯å¾‘ï¼š`/admin`
åŠŸèƒ½ï¼š
- é¡¯ç¤ºç³»çµ±çµ±è¨ˆæ•¸æ“š
- å¿«é€Ÿå°èˆªåˆ°å„ç®¡ç†åŠŸèƒ½
- åŒ…å«ã€Œå¸æ©Ÿç”³è«‹å¯©æ ¸ã€å’Œã€Œä¹˜å®¢ç”³è«‹å¯©æ ¸ã€å…¥å£

### å¸æ©Ÿç”³è«‹å¯©æ ¸é é¢
è·¯å¾‘ï¼š`/admin/driver-applications`
åŠŸèƒ½ï¼š
- é¡¯ç¤ºæ‰€æœ‰å¸æ©Ÿç”³è«‹åˆ—è¡¨
- ç¯©é¸å™¨ï¼šå…¨éƒ¨ã€å¾…å¯©æ ¸ã€å·²é€šéã€å·²æ‹’çµ•
- æœå°‹åŠŸèƒ½ï¼šå§“åã€é›»è©±ã€è»Šç‰Œ
- æŸ¥çœ‹è©³æƒ…ã€é€šéã€æ‹’çµ•æ“ä½œ

### ä¹˜å®¢ç”³è«‹å¯©æ ¸é é¢
è·¯å¾‘ï¼š`/admin/passenger-applications`
åŠŸèƒ½ï¼š
- é¡¯ç¤ºæ‰€æœ‰ä¹˜å®¢ç”³è«‹åˆ—è¡¨
- ç¯©é¸å™¨ï¼šå…¨éƒ¨ã€å¾…å¯©æ ¸ã€å·²é€šéã€å·²æ‹’çµ•
- æœå°‹åŠŸèƒ½ï¼šå§“åã€é›»è©±
- æŸ¥çœ‹è©³æƒ…ã€é€šéã€æ‹’çµ•æ“ä½œ

## ç™»å…¥æ¬Šé™æ§åˆ¶

### å¯©æ ¸å‰ï¼ˆpending ç‹€æ…‹ï¼‰
- âŒ å¸æ©Ÿç„¡æ³•ç™»å…¥
- âŒ ä¹˜å®¢ç„¡æ³•ç™»å…¥
- é¡¯ç¤ºè¨Šæ¯ï¼šã€Œæ‚¨çš„ç”³è«‹æ­£åœ¨å¯©æ ¸ä¸­ï¼Œè«‹è€å¿ƒç­‰å¾…ã€

### å¯©æ ¸é€šéï¼ˆactive ç‹€æ…‹ï¼‰
- âœ… å¸æ©Ÿå¯ç™»å…¥ä¸¦é–‹å§‹æ¥å–®
- âœ… ä¹˜å®¢å¯ç™»å…¥ä¸¦é–‹å§‹å«è»Š

### å¯©æ ¸æ‹’çµ•ï¼ˆrejected ç‹€æ…‹ï¼‰
- âŒ å¸æ©Ÿç„¡æ³•ç™»å…¥
- âŒ ä¹˜å®¢ç„¡æ³•ç™»å…¥
- é¡¯ç¤ºæ‹’çµ•åŸå› å’Œå®¢æœè¯çµ¡è³‡è¨Š

## æ¸¬è©¦æ•¸æ“š

ç³»çµ±å·²å‰µå»ºä»¥ä¸‹æ¸¬è©¦ç”³è«‹ç”¨æ–¼é©—è­‰ï¼š

### å¾…å¯©æ ¸å¸æ©Ÿ
- å§“åï¼šæ¸¬è©¦å¸æ©Ÿæå¤§è¯
- æ‰‹æ©Ÿï¼š0922222222
- è»Šç‰Œï¼šDEF-5678
- ç‹€æ…‹ï¼špending

### å¾…å¯©æ ¸ä¹˜å®¢
- å§“åï¼šæ¸¬è©¦ä¹˜å®¢ç‹å°æ˜
- æ‰‹æ©Ÿï¼š0911111111
- ç‹€æ…‹ï¼špending

## ä½¿ç”¨æµç¨‹ç¤ºç¯„

### ç®¡ç†å“¡å¯©æ ¸æµç¨‹

1. **ç™»å…¥å¾Œå°**
   ```
   é–‹å•Ÿ /admin
   ```

2. **æŸ¥çœ‹å¸æ©Ÿç”³è«‹**
   ```
   é»æ“Šã€Œå¸æ©Ÿç”³è«‹å¯©æ ¸ã€
   æŸ¥çœ‹å¾…å¯©æ ¸åˆ—è¡¨
   é»æ“Šã€ŒæŸ¥çœ‹è©³æƒ…ã€æª¢è¦–å®Œæ•´è³‡æ–™
   ```

3. **å¯©æ ¸æ±ºå®š**
   ```
   é€šéï¼šé»æ“Šã€Œé€šéã€â†’ ç¢ºèª
   æ‹’çµ•ï¼šé»æ“Šã€Œæ‹’çµ•ã€â†’ è¼¸å…¥åŸå›  â†’ ç¢ºèª
   ```

4. **æŸ¥çœ‹ä¹˜å®¢ç”³è«‹**
   ```
   è¿”å›é¦–é 
   é»æ“Šã€Œä¹˜å®¢ç”³è«‹å¯©æ ¸ã€
   é‡è¤‡æ­¥é©Ÿ 2-3
   ```

## é€šçŸ¥ç³»çµ±

å¯©æ ¸çµæœæœƒé€šé `notifications` è¡¨ç™¼é€çµ¦ç”³è«‹è€…ï¼š

### é€šéé€šçŸ¥
- æ¨™é¡Œï¼šã€ŒğŸ‰ è¨»å†Šå¯©æ ¸é€šéï¼ã€
- å…§å®¹ï¼šèªªæ˜å¸³è™Ÿå·²å•Ÿç”¨ï¼Œå¯ä»¥é–‹å§‹ä½¿ç”¨æœå‹™

### æ‹’çµ•é€šçŸ¥
- æ¨™é¡Œï¼šã€Œè¨»å†Šå¯©æ ¸çµæœã€
- å…§å®¹ï¼šæ‹’çµ•åŸå›  + å®¢æœè¯çµ¡è³‡è¨Š

## è³‡æ–™å®Œæ•´æ€§

### ç¾æœ‰æ•¸æ“šç‹€æ…‹
```
å¸æ©Ÿç”³è«‹ï¼š
- ç¸½æ•¸ï¼š2
- å¾…å¯©æ ¸ï¼š1
- å·²é€šéï¼š1
- å·²æ‹’çµ•ï¼š0

ä¹˜å®¢ç”³è«‹ï¼š
- ç¸½æ•¸ï¼š4
- å¾…å¯©æ ¸ï¼š2
- å·²é€šéï¼š1
- å·²æ‹’çµ•ï¼š1

ç”¨æˆ¶ç‹€æ…‹ï¼š
- active driver: 1
- pending driver: 1
- active passenger: 1
- pending passenger: 1
```

### è³‡æ–™ä¸²è¯é©—è­‰
âœ… æ‰€æœ‰ users è¨˜éŒ„éƒ½æœ‰å°æ‡‰çš„ application è¨˜éŒ„
âœ… æ‰€æœ‰ drivers è¨˜éŒ„éƒ½æœ‰å°æ‡‰çš„ driver_applications è¨˜éŒ„
âœ… æ‰€æœ‰å¯©æ ¸ç‹€æ…‹æ­£ç¢ºåŒæ­¥

## å®‰å…¨æ³¨æ„äº‹é …

1. **å¯†ç¢¼è™•ç†**ï¼šä½¿ç”¨ base64 ç·¨ç¢¼ï¼ˆç”Ÿç”¢ç’°å¢ƒæ‡‰ä½¿ç”¨ bcryptï¼‰
2. **æ¬Šé™æ§åˆ¶**ï¼šéœ€å¯¦ä½œç®¡ç†å“¡èº«åˆ†é©—è­‰
3. **è³‡æ–™é©—è­‰**ï¼šå‰ç«¯å’Œå¾Œç«¯éƒ½éœ€é©—è­‰è¼¸å…¥è³‡æ–™
4. **RLS æ”¿ç­–**ï¼šç¢ºä¿è³‡æ–™åº« Row Level Security æ­£ç¢ºè¨­å®š

## å¾ŒçºŒå„ªåŒ–å»ºè­°

1. å¯¦ä½œæ›´å®Œå–„çš„èº«åˆ†é©—è­‰æ©Ÿåˆ¶
2. åŠ å…¥æ–‡ä»¶ä¸Šå‚³åŠŸèƒ½ï¼ˆé§•ç…§ã€èº«åˆ†è­‰ç…§ç‰‡ï¼‰
3. å¯¦ä½œæ‰¹æ¬¡å¯©æ ¸åŠŸèƒ½
4. åŠ å…¥å¯©æ ¸æ­·å²è¨˜éŒ„
5. å¯¦ä½œé›»å­éƒµä»¶/ç°¡è¨Šé€šçŸ¥
6. åŠ å…¥ç”³è«‹å„ªå…ˆç´šè‡ªå‹•åˆ¤æ–·
7. å¯¦ä½œäºŒæ¬¡å¯©æ ¸æ©Ÿåˆ¶
8. åŠ å…¥ç”³è«‹æ•¸æ“šåˆ†æå ±è¡¨

## ç¸½çµ

âœ… å®Œæ•´çš„é›™å‘å¯©æ ¸ç³»çµ±å·²å»ºç«‹
âœ… å¸æ©Ÿå’Œä¹˜å®¢éƒ½éœ€è¦ç¶“éå¯©æ ¸æ‰èƒ½ä½¿ç”¨æœå‹™
âœ… å¾Œå°ç®¡ç†åŠŸèƒ½å®Œå–„
âœ… è³‡æ–™ä¸²è¯æ­£ç¢º
âœ… æ‰€æœ‰å¯©æ ¸è¨˜éŒ„éƒ½æœƒä¿å­˜
âœ… é€šçŸ¥ç³»çµ±å·²æ•´åˆ

ç³»çµ±ç¾åœ¨å¯ä»¥ç¢ºä¿åªæœ‰ç¶“éå¯©æ ¸çš„ç”¨æˆ¶æ‰èƒ½ä½¿ç”¨æœå‹™ï¼Œæé«˜å¹³å°çš„å®‰å…¨æ€§å’Œå¯ä¿¡åº¦ã€‚
